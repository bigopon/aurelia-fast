import{IObserverLocator as t}from"@aurelia/runtime";import{ComputedWatcher as e,INode as s,Controller as n,IObserverLocator as r,Scope as i,CustomAttribute as o}from"@aurelia/runtime-html";import{Registration as c}from"@aurelia/kernel";class h{constructor(t,e,s){this.type=t,this.attrs=e,this.children=s}}class a{constructor(t,e,s){this.type=t,this.attrs=e,this.children=s}}class u{constructor(t,e){this.type=t,this.expression=e}get __te(){return!0}compile(t,e,s){return new l(this.type,this.expression)}}class l{constructor(t,e){this.type=t,this.expression=e}get __be(){return!0}create(t){return new p(t,this.type,this.expression)}}class p{constructor(t,e,s){this.target=t,this.type=e,this.expression=s}bind(t){this.scope=t,this.target.addEventListener(this.type,this)}unbind(){this.scope=void 0,this.target.removeEventListener(this.type,this)}handleEvent(t){this.expression.call(void 0,this.scope.source,t,this.scope)}}class f{constructor(t){this.type=t}get __te(){return!0}compile(t,e,s){return new d(this.type)}}class d{constructor(t){this.type=t}get __be(){return!0}create(t){return new g(t,this.type)}}class w{constructor(t){this.type=t}get __te(){return!0}compile(t,e,s){return new y(this.type)}}class y{constructor(t){this.type=t}get __be(){return!0}create(t){return new g(t.$au.viewModel,this.type)}}class g{constructor(t,e){this.target=t,this.key=e}bind(t){this.scope=t,t.source[this.key]=this.target}unbind(){this.scope.source[this.key]===this.target&&(this.scope.source[this.key]=null)}}class b extends Error{constructor(t){super(t?`Not implemented: ${t}`:"Not implemented")}}class m{constructor(t,e){this.toView=t,this.fromView=e}get __te(){return!0}compile(t,e,s){return new v(e,[this.toView,this.fromView],s)}}class x{constructor(t){this.expressions=t}get __be(){return!0}create(t){if(!t)throw new Error("Invalid usage of prop binding expression. Example: prop=${x => x.value}");throw t.$au?.viewModel,new b}}class _{constructor(t,e,s){this.key=t,this.expression=e,this.context=s}get __be(){return!0}create(e){const s=e.$au?.viewModel;return s&&this.key in s?new k(this.key,s,this.expression,this.context.get(t)):new k(this.key,e,this.expression,this.context.get(t))}}class v{constructor(t,e,s){this.key=t,this.expressions=e,this.context=s}get __be(){return!0}create(e){return new E(this.key,e,this.expressions,this.context.get(t))}}class k{constructor(t,e,s,n){this.key=t,this.target=e,this.expression=s,this.oLocator=n}bind(t){new e(t.source,this.oLocator,this.expression,(t=>{this.target[this.key]=t}),!0).$bind(),this.target[this.key]=this.expression(t.source,t,t)}unbind(){throw new b}}class E{constructor(t,e,s,n){this.key=t,this.target=e,this.exprs=s,this.oLocator=n}bind(t){const s=this.oLocator.getObserver(this.target,this.key);s.setValue(this.exprs[0](t.source,t,t),0,this.target,this.key),s.subscribe({handleChange:e=>{this.exprs[1](e,t.source,null,t)}});new e(t.source,this.oLocator,this.exprs[0],(t=>{this.target[this.key]!==t&&(this.target[this.key]=t)}),!0).$bind()}unbind(){throw new b}}class C{constructor(t,e,s){this.context=t,this.Type=e,this.expressions=s}get __be(){return!0}create(t){const e=this.context.createChild();e.register(c.instance(s,t),c.instance(Element,t),c.instance(HTMLElement,t));const i=e.invoke(this.Type),o=n.forCustomAttribute(null,this.context,i,t,0);return new L(o,this.expressions,this.context.get(r))}}class L{constructor(t,e,s){this.controller=t,this.expressions=e,this.oLocator=s,this.watchers=[]}bind(t){const s=t.source,{controller:n,controller:{viewModel:r},expressions:o}=this;if(n.activate(n,null,2,i.create(s)),"function"==typeof o){const n=this.oLocator.getObserver(r,"value"),i=new e(s,this.oLocator,o,(t=>{n.setValue(t,0)}),!0);n.setValue(o(s,t,t),0),i.$bind(),this.watchers.push(i)}else{if(o instanceof Array)throw new b("CA two way binding");for(const n in o){const i=o[n];if(i instanceof Array)throw new b("CA two way binding");if("function"!=typeof i)throw new b("Only lambda supported for CA binding");const c=this.oLocator.getAccessor(r,n),h=new e(s,this.oLocator,i,(t=>{c.setValue(t,0)}),!0);c.setValue(i(s,t,t),0),h.$bind(),this.watchers.push(h)}}}unbind(){throw new b}}class ${constructor(t,e){this.context=t,this.expressions=e}get __be(){return!0}create(e){return new A(e,this.expressions,this.context.get(t))}}class A{constructor(t,e,s){this.el=t,this.expressions=e,this.oLocator=s}bind(t){const s=t.source,{expressions:n,el:r}=this;for(const i in n){const o=n[i],c=new e(s,this.oLocator,o,(t=>{r.style[i]=t}),!0);r.style[i]=o(t.source,t,t),c.$bind()}}unbind(){}}function V(t){return!0===t?.__te}class O{constructor(t){this.nodes=t}compile(t){return new M(this.nodes.map((function e(s){return new a(s.type,null===s.attrs?[]:Object.entries(s.attrs).map((([e,n])=>{const r=function(t){return/^a__\d+$/.test(t)}(e);if(!r){const r=t.find(o,e);if(r){const i={};if(null==n)throw new Error("Expression cannot be null");switch(typeof n){case"object":if(V(n))i.value=n.compile(s,e,t);else if(!(n instanceof Array))for(const e in n){const r=n[e];if(V(r))i[e]=r.compile(s,e,t);else{if(!("function"==typeof r||r instanceof Array&&("function"==typeof r[0]||"function"==typeof r[1])))throw new Error("Invalid CA binding usage");i[e]=r}}}return new C(t,r.Type,i)}}switch(e){case"style":return new $(t,n)}switch(typeof n){case"object":if(null===n)throw new Error("Expression cannot be null");if(V(n))return n.compile(s,r?null:e,t);if(!(n instanceof Array))return new x(Object.entries(n).reduce(((e,[n,i])=>(V(i)?i=i.compile(s,r?null:n,t):"function"==typeof i&&(i=new _(n,i,t)),e[n]=i,e)),{}));{if(r)throw new Error("Array syntax cannot be used without target prop");const[s,i]=n;if("function"!=typeof s&&"function"!=typeof i)throw new Error("Binding must be at least have 1 direction");if(s&&i)return new v(e,n,t)}case"function":if(r)throw new Error(`No key for lambda: ${n.toString()}`);return new _(e,n,t)}return{name:e,value:n}})),s.children.map((t=>"string"==typeof t?t:e(t))))})))}}class M{constructor(t){this.nodes=t}render(){const t=document.createDocumentFragment(),e=[];function s(t,n){const r=n.appendChild(document.createElement("string"==typeof t.type?t.type:t.type.name));t.attrs.forEach((t=>{if(!0===t?.__be)e.push(t.create(r));else{const{name:e,value:s}=t;/^data-|aria-|\w+:\w+/.test(e)?r.setAttribute(e,s):r[e]=s}})),t.children.forEach((t=>"string"==typeof t?r.appendChild(document.createTextNode(t)):s(t,r)))}return this.nodes.forEach((e=>s(e,t))),new N(t,e)}}class N{constructor(t,e){this.fragment=t,this.bindings=e,t.hasChildNodes()&&(this.firstChild=t.firstChild,this.lastChild=t.lastChild)}insertBefore(t){t.parentNode.insertBefore(this.fragment,t)}appendTo(t){t.appendChild(this.fragment)}remove(){let t,e=this.firstChild;for(;null!=e&&e!==this.lastChild;)t=e,e=e.nextSibling,this.fragment.appendChild(t)}bind(t){this.bindings.forEach((e=>e.bind(t)))}unbind(){this.bindings.forEach((t=>t.unbind()))}}function T(t,e){return new u(t,e)}function j(t){return new f(t)}function B(t){return new w(t)}function I(t,e){return new m(t,e)}function S(t,...e){return new O(F.call(D,t,...e))}function D(t,e,...s){return new h(t,e,s)}const F=function(t){const e=arguments,s=this,n=new WeakMap,r=t=>{const e=(n.get(t)??0)+1;return n.set(t,e),e-1};let i,o,c=1,h="",a="",u=[0];const l=t=>{1===c&&(t||(h=h.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(t?e[t]:h):3===c&&(t||h)?(u[1]=t?e[t]:h,c=2):2===c&&"..."===h&&t?u[2]=Object.assign(u[2]??(u[2]={}),e[t]):2===c&&h&&!t?(u[2]??(u[2]={}))[h]=!0:2===c&&!h&&t?(u[2]??(u[2]={}))[`a__${r(u[2])}`]=e[t]:c>=5&&(5===c?((u[2]=u[2]||{})[o]=t?h?h+e[t]:e[t]:h,c=6):(t||h)&&(u[2][o]+=t?h+e[t]:h)),h=""};for(let e=0;e<t.length;e++){e&&(1===c&&l(),l(e));for(let n=0;n<t[e].length;n++)i=t[e][n],1===c?"<"===i?(l(),u=[u,"",null],c=3):h+=i:4===c?"--"===h&&">"===i?(c=1,h=""):h=i+h[0]:a?i===a?a="":h+=i:'"'===i||"'"===i?a=i:">"===i?(l(),c=1):c&&("="===i?(c=5,o=h,h=""):"/"===i&&(c<5||">"===t[e][n+1])?(l(),3===c&&(u=u[0]),c=u,(u=u[0]).push(s.apply(null,c.slice(1))),c=0):" "===i||"\t"===i||"\n"===i||"\r"===i?(l(),c=2):h+=i),3===c&&"!--"===h&&(c=4,u=u[0])}return l(),u.length>2?u.slice(1):u[1]};export{T as On,j as Ref,I as TwoWay,B as ViewModelRef,S as html};
//# sourceMappingURL=index.min.js.map
