"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@aurelia/runtime"),e=require("@aurelia/runtime-html"),s=require("@aurelia/kernel");class r{constructor(t,e,s){this.type=t,this.attrs=e,this.children=s}}class n{constructor(t,e,s){this.type=t,this.attrs=e,this.children=s}}class i{constructor(t,e){this.type=t,this.expression=e}get __te(){return!0}compile(t,e,s){return new o(this.type,this.expression)}}class o{constructor(t,e){this.type=t,this.expression=e}get __be(){return!0}create(t){return new c(t,this.type,this.expression)}}class c{constructor(t,e,s){this.target=t,this.type=e,this.expression=s}bind(t){this.scope=t,this.target.addEventListener(this.type,this)}unbind(){this.scope=void 0,this.target.removeEventListener(this.type,this)}handleEvent(t){this.expression.call(void 0,this.scope.source,t,this.scope)}}class h{constructor(t){this.type=t}get __te(){return!0}compile(t,e,s){return new a(this.type)}}class a{constructor(t){this.type=t}get __be(){return!0}create(t){return new p(t,this.type)}}class u{constructor(t){this.type=t}get __te(){return!0}compile(t,e,s){return new l(this.type)}}class l{constructor(t){this.type=t}get __be(){return!0}create(t){return new p(t.$au.viewModel,this.type)}}class p{constructor(t,e){this.target=t,this.key=e}bind(t){this.scope=t,t.source[this.key]=this.target}unbind(){this.scope.source[this.key]===this.target&&(this.scope.source[this.key]=null)}}class d extends Error{constructor(t){super(t?`Not implemented: ${t}`:"Not implemented")}}class f{constructor(t,e){this.toView=t,this.fromView=e}get __te(){return!0}compile(t,e,s){return new g(e,[this.toView,this.fromView],s)}}class w{constructor(t){this.expressions=t}get __be(){return!0}create(t){if(!t)throw new Error("Invalid usage of prop binding expression. Example: prop=${x => x.value}");throw t.$au?.viewModel,new d}}class y{constructor(t,e,s){this.key=t,this.expression=e,this.context=s}get __be(){return!0}create(e){const s=e.$au?.viewModel;return s&&this.key in s?new b(this.key,s,this.expression,this.context.get(t.IObserverLocator)):new b(this.key,e,this.expression,this.context.get(t.IObserverLocator))}}class g{constructor(t,e,s){this.key=t,this.expressions=e,this.context=s}get __be(){return!0}create(e){return new x(this.key,e,this.expressions,this.context.get(t.IObserverLocator))}}class b{constructor(t,e,s,r){this.key=t,this.target=e,this.expression=s,this.oLocator=r}bind(t){new e.ComputedWatcher(t.source,this.oLocator,this.expression,(t=>{this.target[this.key]=t}),!0).$bind(),this.target[this.key]=this.expression(t.source,t,t)}unbind(){throw new d}}class x{constructor(t,e,s,r){this.key=t,this.target=e,this.exprs=s,this.oLocator=r}bind(t){const s=this.oLocator.getObserver(this.target,this.key);s.setValue(this.exprs[0](t.source,t,t),0,this.target,this.key),s.subscribe({handleChange:e=>{this.exprs[1](e,t.source,null,t)}});new e.ComputedWatcher(t.source,this.oLocator,this.exprs[0],(t=>{this.target[this.key]!==t&&(this.target[this.key]=t)}),!0).$bind()}unbind(){throw new d}}class m{constructor(t,e,s){this.context=t,this.Type=e,this.expressions=s}get __be(){return!0}create(t){const r=this.context.createChild();r.register(s.Registration.instance(e.INode,t),s.Registration.instance(Element,t),s.Registration.instance(HTMLElement,t));const n=r.invoke(this.Type),i=e.Controller.forCustomAttribute(null,this.context,n,t,0);return new _(i,this.expressions,this.context.get(e.IObserverLocator))}}class _{constructor(t,e,s){this.controller=t,this.expressions=e,this.oLocator=s,this.watchers=[]}bind(t){const s=t.source,{controller:r,controller:{viewModel:n},expressions:i}=this;if(r.activate(r,null,2,e.Scope.create(s)),"function"==typeof i){const r=this.oLocator.getObserver(n,"value"),o=new e.ComputedWatcher(s,this.oLocator,i,(t=>{r.setValue(t,0)}),!0);r.setValue(i(s,t,t),0),o.$bind(),this.watchers.push(o)}else{if(i instanceof Array)throw new d("CA two way binding");for(const r in i){const o=i[r];if(o instanceof Array)throw new d("CA two way binding");if("function"!=typeof o)throw new d("Only lambda supported for CA binding");const c=this.oLocator.getAccessor(n,r),h=new e.ComputedWatcher(s,this.oLocator,o,(t=>{c.setValue(t,0)}),!0);c.setValue(o(s,t,t),0),h.$bind(),this.watchers.push(h)}}}unbind(){throw new d}}class v{constructor(t,e){this.context=t,this.expressions=e}get __be(){return!0}create(e){return new C(e,this.expressions,this.context.get(t.IObserverLocator))}}class C{constructor(t,e,s){this.el=t,this.expressions=e,this.oLocator=s}bind(t){const s=t.source,{expressions:r,el:n}=this;for(const i in r){const o=r[i],c=new e.ComputedWatcher(s,this.oLocator,o,(t=>{n.style[i]=t}),!0);n.style[i]=o(t.source,t,t),c.$bind()}}unbind(){}}function k(t){return!0===t?.__te}class E{constructor(t){this.nodes=t}compile(t){return new L(this.nodes.map((function s(r){return new n(r.type,null===r.attrs?[]:Object.entries(r.attrs).map((([s,n])=>{const i=function(t){return/^a__\d+$/.test(t)}(s);if(!i){const i=t.find(e.CustomAttribute,s);if(i){const e={};if(null==n)throw new Error("Expression cannot be null");switch(typeof n){case"object":if(k(n))e.value=n.compile(r,s,t);else if(!(n instanceof Array))for(const s in n){const i=n[s];if(k(i))e[s]=i.compile(r,s,t);else{if(!("function"==typeof i||i instanceof Array&&("function"==typeof i[0]||"function"==typeof i[1])))throw new Error("Invalid CA binding usage");e[s]=i}}}return new m(t,i.Type,e)}}switch(s){case"style":return new v(t,n)}switch(typeof n){case"object":if(null===n)throw new Error("Expression cannot be null");if(k(n))return n.compile(r,i?null:s,t);if(!(n instanceof Array))return new w(Object.entries(n).reduce(((e,[s,n])=>(k(n)?n=n.compile(r,i?null:s,t):"function"==typeof n&&(n=new y(s,n,t)),e[s]=n,e)),{}));{if(i)throw new Error("Array syntax cannot be used without target prop");const[e,r]=n;if("function"!=typeof e&&"function"!=typeof r)throw new Error("Binding must be at least have 1 direction");if(e&&r)return new g(s,n,t)}case"function":if(i)throw new Error(`No key for lambda: ${n.toString()}`);return new y(s,n,t)}return{name:s,value:n}})),r.children.map((t=>"string"==typeof t?t:s(t))))})))}}class L{constructor(t){this.nodes=t}render(){const t=document.createDocumentFragment(),e=[];function s(t,r){const n=r.appendChild(document.createElement("string"==typeof t.type?t.type:t.type.name));t.attrs.forEach((t=>{if(!0===t?.__be)e.push(t.create(n));else{const{name:e,value:s}=t;/^data-|aria-|\w+:\w+/.test(e)?n.setAttribute(e,s):n[e]=s}})),t.children.forEach((t=>"string"==typeof t?n.appendChild(document.createTextNode(t)):s(t,n)))}return this.nodes.forEach((e=>s(e,t))),new A(t,e)}}class A{constructor(t,e){this.fragment=t,this.bindings=e,t.hasChildNodes()&&(this.firstChild=t.firstChild,this.lastChild=t.lastChild)}insertBefore(t){t.parentNode.insertBefore(this.fragment,t)}appendTo(t){t.appendChild(this.fragment)}remove(){let t,e=this.firstChild;for(;null!=e&&e!==this.lastChild;)t=e,e=e.nextSibling,this.fragment.appendChild(t)}bind(t){this.bindings.forEach((e=>e.bind(t)))}unbind(){this.bindings.forEach((t=>t.unbind()))}}function $(t,e,...s){return new r(t,e,s)}const O=function(t){const e=arguments,s=this,r=new WeakMap,n=t=>{const e=(r.get(t)??0)+1;return r.set(t,e),e-1};let i,o,c=1,h="",a="",u=[0];const l=t=>{1===c&&(t||(h=h.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(t?e[t]:h):3===c&&(t||h)?(u[1]=t?e[t]:h,c=2):2===c&&"..."===h&&t?u[2]=Object.assign(u[2]??(u[2]={}),e[t]):2===c&&h&&!t?(u[2]??(u[2]={}))[h]=!0:2===c&&!h&&t?(u[2]??(u[2]={}))[`a__${n(u[2])}`]=e[t]:c>=5&&(5===c?((u[2]=u[2]||{})[o]=t?h?h+e[t]:e[t]:h,c=6):(t||h)&&(u[2][o]+=t?h+e[t]:h)),h=""};for(let e=0;e<t.length;e++){e&&(1===c&&l(),l(e));for(let r=0;r<t[e].length;r++)i=t[e][r],1===c?"<"===i?(l(),u=[u,"",null],c=3):h+=i:4===c?"--"===h&&">"===i?(c=1,h=""):h=i+h[0]:a?i===a?a="":h+=i:'"'===i||"'"===i?a=i:">"===i?(l(),c=1):c&&("="===i?(c=5,o=h,h=""):"/"===i&&(c<5||">"===t[e][r+1])?(l(),3===c&&(u=u[0]),c=u,(u=u[0]).push(s.apply(null,c.slice(1))),c=0):" "===i||"\t"===i||"\n"===i||"\r"===i?(l(),c=2):h+=i),3===c&&"!--"===h&&(c=4,u=u[0])}return l(),u.length>2?u.slice(1):u[1]};exports.On=function(t,e){return new i(t,e)},exports.Ref=function(t){return new h(t)},exports.TwoWay=function(t,e){return new f(t,e)},exports.ViewModelRef=function(t){return new u(t)},exports.html=function(t,...e){return new E(O.call($,t,...e))};
//# sourceMappingURL=index.min.js.map
